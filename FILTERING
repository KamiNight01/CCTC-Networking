
COMMAND TO VIEW FILTER TABLES
sudo iptables -L 
sudo iptables -t nat -L
sudo iptables -L --line to show the line numbers 
 sudo iptables -L -v    ---- to track connections on how many packet triggered them. 

Ctrl R -- reverse search 


sudo iptables  -F         --- to FLUSH
sudo iptables -t nat -F

Explicitly open ssh for both input and output 

 sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
 sudo iptables -A INPUT -p tcp --sport 22 -j ACCEPT
 sudo iptables -A OUTPUT -p tcp --dport 22 -j ACCEPT
 sudo iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT
 
  set default policy fron accept to drop 
  
  sudo iptables -P INPUT DROP
  ------------------------------------
  sudo iptables -P FORWARD DROP      -P t change the default policy    



 To set on multiple ports 
sudo iptables -A INPUT -p tcp -m multiport --ports 22,6010,6011,6012 ( 
sudo iptables -A INPUT -p tcp -m multiport --ports 22,6010,6011,6012  -m state --state NEW,ESTABLISHED -j ACCEPT
( also matches on state NEW or ESTABLISHED as well as accept)
sudo iptables -A OUTPUT -p tcp -m multiport --ports 22,6010,6011,6012  -m state --state NEW,ESTABLISHED -j ACCEPT

sudo iptables  -D  OUTPUT 4  (deletes  the OUTPUT rule on number 4 ) 

sudo iptables -I INPUT -s 172.16.82.106 -j DROP
sudo iptables -I OUTPUT -d 172.16.82.106 -j DROP



sudo iptables -A  OUTPUT -d 172.16.82.112 -j ACCEPT
sudo iptables -A  INPUT -s 172.16.82.112 -j ACCEPT



for CHAIN in INPUT OUTPUT FORWARD;do sudo iptables -P $CHAIN DROP;done
for CHAIN in INPUT OUTPUT FORWARD;do sudo iptables -P $CHAIN ACCEPT;done



#Drops invalid fragments ( not belonging to any connections) 
sudo iptables -A INPUT -m state --state INVALID -j DROP

#Drop fragments
sudo iptables -A INPUT

#throttle syn request and limit to 10 per seconds 
sudo iptables -A INPUT -i eth0 -p tcp --syn -m limit --limit 10/second -j ACCEPT
sudo iptables-save > ipt.conf
sudo iptables-restore < ipt.conf


-------------------------------------------------------------------------------------------------------------------------------------------------------
sudo apt-get install nftables
 sudo nft list tables
 sudo nft flush table ip CCTC    ----- to flush
 sudo nft delete table ip CCTC      -------- to delete
  sudo nft insert rule ip CCTC input tcp dport 22 accept
  to create a chain called input for input
 sudo nft add chain ip CCTC Output { type filter hook output priority 0 \; policy accept \; }    -- to create a cjain called Output in output 
 
 
 sudo nft insert rule ip CCTC input tcp sport 22 accept
 sudo nft insert rule ip CCTC input tcp dport 22 accept   ---- add tcp dest port 
 sudo nft  list ruleset


  opens the  4 different ports for both source  and destination 
  
sudo nft add rule ip CCTC input tcp sport {22, 6010, 6011, 6012} accept
sudo nft add rule ip CCTC input tcp dport {22, 6010, 6011, 6012} accept
sudo nft add rule ip CCTC output tcp sport {22, 6010, 6011, 6012} accept
sudo nft add rule ip CCTC output tcp dport {22, 6010, 6011, 6012} accept

sudo nft add chain ip CCTC output { type filter hook output priority 0 \; policy drop \; }   -----set default policy to drop 


